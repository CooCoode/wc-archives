<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeeDAO投稿 | 差点让比特币系统崩塌的600微秒 - SeeDAO WeChat Archive</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="阴差阳错的双花漏洞。">
    <meta name="keywords" content="SeeDAO, forever121, Web3, DAO, WeChat, 公众号, 文章">
    <meta name="author" content="forever121">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="baiduspider" content="index, follow">
    
    <!-- Alternate Language -->
    <link rel="alternate" hreflang="zh-CN" href="https://wc-archives.netlify.app/articles////.html">
    <link rel="alternate" hreflang="x-default" href="https://wc-archives.netlify.app/articles////.html">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="SeeDAO投稿 | 差点让比特币系统崩塌的600微秒 - SeeDAO WeChat Archive">
    <meta property="og:description" content="阴差阳错的双花漏洞。">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://wc-archives.netlify.app/articles////.html">
    <meta property="og:site_name" content="SeeDAO WeChat Archive">
    <meta property="article:published_time" content="--">
    <meta property="article:author" content="forever121">
    <meta property="article:section" content="Web3">
    <meta property="og:image" content="https://wc-archives.netlify.app/images/default-preview.svg">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="SeeDAO投稿 | 差点让比特币系统崩塌的600微秒 - SeeDAO WeChat Archive">
    <meta name="twitter:description" content="阴差阳错的双花漏洞。">
    <meta name="twitter:image" content="https://wc-archives.netlify.app/images/default-preview.svg">
    
    <!-- Baidu Mobile Adaptation -->
    <meta name="mobile-agent" content="format=html5;url=https://wc-archives.netlify.app/articles////.html">
    <meta name="applicable-device" content="pc,mobile">
    
    <!-- Common Meta Tags -->
    <meta name="description" content="阴差阳错的双花漏洞。">
    <meta name="author" content="forever121">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.5.10/dist/typography.min.css" rel="stylesheet">
    <style>
        /* Custom styles */
        .article-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .article-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }
        .article-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
            line-height: 1.4;
        }
        .article-meta {
            margin-top: 1rem;
            color: #666;
            font-size: 0.9rem;
        }
        .article-digest {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.6;
            margin: 1.5rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .article-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        .category-tag {
            padding: 0.25rem 0.75rem;
            background: #e9ecef;
            color: #495057;
            border-radius: 9999px;
            font-size: 0.875rem;
        }
        .wechat-notice {
            text-align: center;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 2rem 0;
        }
        .wechat-button {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background: #07C160;
            color: white;
            border-radius: 6px;
            text-decoration: none;
            transition: background-color 0.2s;
        }
        .wechat-button:hover {
            background: #06B057;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- JSON-LD for Search Engines -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "SeeDAO投稿 | 差点让比特币系统崩塌的600微秒",
      "description": "阴差阳错的双花漏洞。",
      "author": {
        "@type": "Person",
        "name": "forever121"
      },
      "publisher": {
        "@type": "Organization",
        "name": "SeeDAO",
        "url": "https://wc-archives.netlify.app/"
      },
      "datePublished": "--",
      "inLanguage": "zh-CN",
      "url": "https://wc-archives.netlify.app/articles////.html"
    }
    </script>
    <div class="article-container">
        <nav class="mb-8">
            <a href="../../index.html" class="text-blue-600 hover:text-blue-800">← Back to Archive</a>
        </nav>

        <header class="article-header">
            <h1 class="article-title">SeeDAO投稿 | 差点让比特币系统崩塌的600微秒</h1>
            <div class="article-meta">
                <span class="mr-4">作者: forever121</span>
                <time>发布时间: 2024-04-20 11:49:38</time>
                <div class="article-categories">
                    <span>分类: </span>
                    <span>比特币, Web3, 区块链</span>
                </div>
            </div>
        </header>

        <div class="article-digest">
            阴差阳错的双花漏洞。
        </div>

        <div class="mb-8">
            <img src="images/cover.jpg" alt="Article cover" class="w-full h-auto rounded-lg">
        </div>

        <article class="article-content prose prose-lg mx-auto">
            <section style="font-size: 15px; color: rgb(62, 62, 62); font-family: PingFangSC-light; letter-spacing: 0px; line-height: 2; padding-right: 4px; padding-left: 4px; visibility: visible; opacity: 1;"><section style="margin-top: 10px; margin-bottom: 10px; visibility: visible; opacity: 1;"><section style="display: inline-block; width: auto; border-width: 2px; border-style: dotted; border-color: rgb(162, 253, 76); border-radius: 20px; overflow: hidden; margin-right: 10px; margin-left: 10px; flex: 100 100 0%; height: auto; padding: 10px 5px; visibility: visible; opacity: 1;"><section style="line-height: 1.8; padding-right: 10px; padding-left: 10px; visibility: visible; opacity: 1;"><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">比特币第四次减半已经完成，这个去中心系统已经成功运行了15年，但在2018年披露出的比特币核心客户端漏洞，直接威胁到比特币系统的稳定，堪称比特币最大的漏洞之一，今天给大家介绍一下，2018年9月20日披露的客户端双花漏洞，CVE-2018-17144。</p></section></section></section><section style="margin-top: 10px; margin-bottom: 10px; text-align: left; transform: translate3d(10px, 0px, 0px); visibility: visible; opacity: 1;"><section style="display: inline-block; vertical-align: top; visibility: visible; opacity: 1;"><section style="margin-bottom: -6px; line-height: 1em; padding-right: 2px; padding-left: 2px; font-size: 19px; visibility: visible; opacity: 1;"><p style="visibility: visible; opacity: 1;" class="mb-4"><strong style="visibility: visible; opacity: 1;">什么是比特币核心？</strong></p></section></section></section><section style="visibility: visible; opacity: 1;"><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">比特币核心（Bitcoin Core）由中本聪发起，被认为是"正统"的比特币客户端，也是目前用的最多的，该软件可以验证区块链曾经做过的所有交易，并可以转移资金。</p></section><section style="margin-top: 10px; margin-bottom: 10px; text-align: left; transform: translate3d(10px, 0px, 0px); visibility: visible; opacity: 1;"><section style="display: inline-block; vertical-align: top; visibility: visible; opacity: 1;"><section style="margin-bottom: -6px; line-height: 1em; padding-right: 2px; padding-left: 2px; font-size: 19px; visibility: visible; opacity: 1;"><p style="visibility: visible; opacity: 1;" class="mb-4"><strong style="visibility: visible; opacity: 1;">CVE-2018-17144 是什么？</strong></p></section></section></section><section style="visibility: visible; opacity: 1;"><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">在Bitcoin Core 发布的0.14 - 0.16.2版本中，存在一个极为严重的漏洞，将会导致程序崩溃和双花问题，也就是说一比交易包含的输入可以输出多次，将会造成无限增发，破坏比特币总量2100万枚的共识，造成通货膨胀，后被公共漏洞收录为 CVE-2018-17144。</p></section><section style="margin-top: 10px; margin-bottom: 10px; text-align: left; transform: translate3d(10px, 0px, 0px); visibility: visible; opacity: 1;"><section style="display: inline-block; vertical-align: top; visibility: visible; opacity: 1;"><section style="margin-bottom: -6px; line-height: 1em; padding-right: 2px; padding-left: 2px; font-size: 19px; visibility: visible; opacity: 1;"><p style="visibility: visible; opacity: 1;" class="mb-4"><strong style="visibility: visible; opacity: 1;">为什么会有这个漏洞？</strong></p></section></section></section><section style="visibility: visible; opacity: 1;"><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">这得追溯到2016年，没错虽然是2018年发现的漏洞，但在2016年就已经埋下了伏笔，在2016年一位开发者向Bitcoin Core提出了一个合并请求（</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">https://github.com/bitcoin/bitcoin/pull/9049），</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">希望删除在交易检查中重复的输入检查，这将节省约600微秒的时间，随后审核者通过了此合并，此时这颗炸弹已经埋下。</p><section style="visibility: visible; opacity: 1;"><p style="visibility: visible; opacity: 1;" class="mb-4">在0.14.x版本中，将此漏洞正式上线客户端代码中，此时如果充分利用这个漏洞，将会导致收到广播的客户端崩溃，并不影响链上数据，其他客户端可以对发起攻击节点的广播丢弃掉，并且要触发这个攻击需要攻击者发掘一个区块，这个成本非常高，也只能让部分客户端崩溃，并没给攻击者带来收益。</p><p style="visibility: visible; opacity: 1;" class="mb-4">直到2017年9月发布的0.15版本中，开发者对UTXO数据库的结构进行了优化，偶然的允许了客户端在重复输入的情况下可以继续操作，为此漏洞打开了双花的可能性。</p></section></section><section style="margin-top: 10px; margin-bottom: 10px; text-align: left; transform: translate3d(10px, 0px, 0px); visibility: visible; opacity: 1;"><section style="display: inline-block; vertical-align: top; visibility: visible; opacity: 1;"><section style="margin-bottom: -6px; line-height: 1em; padding-right: 2px; padding-left: 2px; font-size: 19px; visibility: visible; opacity: 1;"><p style="visibility: visible; opacity: 1;" class="mb-4"><strong style="visibility: visible; opacity: 1;">该漏洞是怎么发现的？</strong></p></section></section></section><section style="visibility: visible; opacity: 1;"><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">在0.15版本发布后，直到2018年9月17日，1年的时间内并没有人发现这个漏洞，直到BCH开发者awemany在中午，坐在海边的小货车里，在BCH代码库中发现这条评论</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4"><strong style="visibility: visible; opacity: 1;">// Check for duplicate inputs — note that this check is slow so we skip it in CheckBlock</strong></p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">awemany感觉到了不对，使用regtest模式测试重复输入的事物，结果直接提示</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4"><strong style="visibility: visible; opacity: 1;">Wham! assert(), Aborted.</strong></p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">他意识到了这可能会被利用，进而导致通货膨胀和分裂链的危险，并在写到</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">BitcoinABC does not check for duplicate inputs when processing a block,&nbsp;<span style="letter-spacing: 0px; visibility: visible; opacity: 1;">only when inserting a transaction into the mempool.</span></p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">This is dangerous as blocks can be generated with duplicate transactions&nbsp;<span style="letter-spacing: 0px; visibility: visible; opacity: 1;">and then sent through e.g. compact block missing transactions and avoid&nbsp;</span><span style="letter-spacing: 0px; visibility: visible; opacity: 1;">hitting the mempool, creating money out of thin air.</span></p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">/u/awemany</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">随后他立即把这个漏洞和修复补丁上报给Bitcoin Core和Bitcoin ABC（BCH开发团队）。</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">他在回顾中写到，提交完后他松了口气，他发现了一个价值数百万美元的漏洞，这个漏洞对价值1000亿美元（现在是1万2千亿美元）的货币可以产生了巨大影响，事实上，他可以租用算力去做空BTC，这可以让他直接发财，但他没有，他选择上报了漏洞。</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">当天21:58，Bitcoin ABC发布了补丁，修复了这个漏洞，向广大节点发送了此消息，督促节点升级，在大多数节点完成升级后，对此漏洞进行了完全披露。</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">然而影响不仅在比特币和BCH还有各种fork比特币核心的山寨币都受到了此漏洞的影响，由于这个漏洞是比特币核心的团队合并的，大家纷纷指责比特币核心团队。</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4">因为600微秒的改动，阴差阳错的导致双花漏洞在链上潜伏了1年的时间，如果这个漏洞一旦被利用，进而可能导致硬分叉，比特币的价格还能有现在这个价格吗？是不是也会和以太坊当年硬分叉一样，诞生另一个ETC。</p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4"><strong style="visibility: visible; opacity: 1;">让我们记住这位开发者：awemany。</strong></p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4"><span style="font-family: PingFangSC-ultralight; visibility: visible; opacity: 1;">参考资料：</span></p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4"><span style="font-family: PingFangSC-ultralight; font-size: 12px; visibility: visible; opacity: 1;">https://medium.com/@awemany/600-microseconds-b70f87b0b2a6</span></p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4"><span style="font-family: PingFangSC-ultralight; font-size: 12px; visibility: visible; opacity: 1;">https://bitcoinops.org/en/topics/cve-2018-17144/</span></p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4"><span style="font-family: PingFangSC-ultralight; font-size: 12px; visibility: visible; opacity: 1;">https://github.com/bitcoin/bitcoin/pull/9049</span></p><p style="text-wrap: wrap; visibility: visible; opacity: 1;" class="mb-4"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MjMwNjgzMA==&amp;mid=2247483702&amp;idx=1&amp;sn=ee8a6695ae2757f0891dd79ec33c10ae&amp;scene=21#wechat_redirect" src="https://mp.weixin.qq.com/s?__biz=MjM5MjMwNjgzMA==&amp;mid=2247483702&amp;idx=1&amp;sn=ee8a6695ae2757f0891dd79ec33c10ae&amp;scene=21#wechat_redirect" style="background-color: rgb(255, 255, 255); letter-spacing: 0px; font-size: 12px; color: rgb(62, 62, 62); font-family: PingFangSC-ultralight; visibility: visible; opacity: 1;">https://mp.weixin.qq.com/s/A2c9AQcJEvEgMhwUfAbafw</a></p></section><section style="visibility: visible; opacity: 1;"><section style="text-align: right; font-size: 12px; visibility: visible; opacity: 1;"><p style="visibility: visible; opacity: 1;" class="mb-4"><span style="background-color: rgb(157, 157, 252); visibility: visible; opacity: 1;">作者</span>｜forever121</p><p style="visibility: visible; opacity: 1;" class="mb-4"><span style="background-color: rgb(157, 157, 252); visibility: visible; opacity: 1;">排版</span>｜Bo</p><p style="visibility: visible; opacity: 1;" class="mb-4"><span style="background-color: rgb(157, 157, 252); visibility: visible; opacity: 1;">审核</span>｜Bo</p></section></section><section style="text-align: left; justify-content: flex-start; display: flex; flex-flow: row; margin-top: 10px; margin-bottom: 10px; visibility: visible; opacity: 1;"><section style="display: inline-block; vertical-align: top; width: auto; min-width: 5%; flex: 0 0 auto; height: auto; align-self: flex-start; visibility: visible; opacity: 1;"><section style="text-align: center; visibility: visible; opacity: 1;"><section style="font-size: 26px; color: rgb(157, 157, 252); padding-right: 10px; padding-left: 10px; visibility: visible; opacity: 1;"><p style="text-align: left; visibility: visible; opacity: 1;" class="mb-4"><em style="visibility: visible; opacity: 1;"><strong style="visibility: visible; opacity: 1;">#推荐阅读</strong></em></p></section></section></section><section style="display: inline-block; vertical-align: top; width: auto; flex: 100 100 0%; height: auto; align-self: flex-start; visibility: visible; opacity: 1;"><section style="text-align: right; font-size: 26px; color: rgb(157, 157, 252); padding-right: 10px; padding-left: 10px; visibility: visible; opacity: 1;"><p style="visibility: visible; opacity: 1;" class="mb-4">●</p></section></section></section></section>
        </article>

    </div>
</body>
</html>
